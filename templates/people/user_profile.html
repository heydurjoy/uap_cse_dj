{% extends 'base.html' %}
{% load static %}

{% block title %}My Profile - CSE UAP{% endblock %}

{% block content %}
<div class="container">
    <section class="user-profile-page">
        <div class="profile-header">
            <a href="{% url 'home' %}" class="back-link">‚Üê Back to Home</a>
        </div>
        
        <!-- Profile Card -->
        <div class="profile-card">
            <div class="profile-image-section">
                {% if profile %}
                    {% if profile_type == 'faculty' and profile.profile_pic %}
                        <img src="/media/{{ profile.profile_pic.name }}" alt="{{ profile.name }}">
                    {% elif profile_type == 'staff' and profile.profile_pic %}
                        <img src="/media/{{ profile.profile_pic.name }}" alt="{{ profile.name }}">
                    {% elif profile_type == 'officer' and profile.profile_pic %}
                        <img src="/media/{{ profile.profile_pic.name }}" alt="{{ profile.name }}">
                    {% elif profile_type == 'club_member' and profile.profile_pic %}
                        <img src="/media/{{ profile.profile_pic.name }}" alt="{{ profile.name }}">
                    {% else %}
                        <img src="{% static 'defaults/people.png' %}" alt="Profile">
                    {% endif %}
                {% else %}
                    <img src="{% static 'defaults/people.png' %}" alt="Profile">
                {% endif %}
            </div>
            
            <div class="profile-info-section">
                <div class="profile-name-section">
                    <h1 class="profile-name">
                        {% if profile %}{{ profile.name }}{% else %}{{ user.get_full_name|default:user.email }}{% endif %}
                    </h1>
                    {% if profile %}
                        {% if profile_type == 'faculty' and profile.designation %}
                            <p class="profile-role">{{ profile.designation }}</p>
                        {% elif profile_type == 'staff' and profile.designation %}
                            <p class="profile-role">{{ profile.designation }}</p>
                        {% elif profile_type == 'officer' and profile.position %}
                            <p class="profile-role">{{ profile.position }}</p>
                        {% elif profile_type == 'club_member' and profile.last_club_position %}
                            <p class="profile-role">{{ profile.last_club_position }}</p>
                        {% endif %}
                    {% endif %}
                    <p class="profile-email">{{ user.email }}</p>
                </div>
                
                <!-- Access Level Badge -->
                <div class="access-level-section">
                    <div class="access-level-badge">
                        <span class="access-level-label">Access Level</span>
                        <span class="access-level-value">
                            {% if user.access_level == '5' %}Head
                            {% elif user.access_level == '4' %}Super Admin
                            {% elif user.access_level == '3' %}Course Access
                            {% elif user.access_level == '2' %}General User
                            {% elif user.access_level == '1' %}Club Member
                            {% else %}Not Set
                            {% endif %}
                        </span>
                    </div>
                    <div class="user-type-badge">
                        <span class="user-type-label">User Type</span>
                        <span class="user-type-value">
                            {% if profile_type == 'faculty' %}Faculty
                            {% elif profile_type == 'staff' %}Staff
                            {% elif profile_type == 'officer' %}Officer
                            {% elif profile_type == 'club_member' %}Club Member
                            {% else %}General User
                            {% endif %}
                        </span>
                    </div>
                </div>
                
                <!-- Quick Info -->
                <!-- <div class="quick-info-grid">
                    {% if profile %}
                        {% if profile_type == 'faculty' and profile.citation %}
                        <div class="quick-info-item">
                            <span class="quick-info-label">Citations</span>
                            <span class="quick-info-value">{{ profile.citation|floatformat:0 }}</span>
                        </div>
                        {% endif %}
                        
                        {% if profile.phone %}
                        <div class="quick-info-item">
                            <span class="quick-info-label">Phone</span>
                            <span class="quick-info-value">{{ profile.phone }}</span>
                        </div>
                        {% endif %}
                        
                        {% if profile.joining_date %}
                        <div class="quick-info-item">
                            <span class="quick-info-label">Joined</span>
                            <span class="quick-info-value">{{ profile.joining_date|date:"M Y" }}</span>
                        </div>
                        {% endif %}
                    {% endif %}
                </div> -->
                
                <!-- Bio -->
                <!-- {% if profile and profile.bio %}
                <div class="profile-bio">
                    <p>{{ profile.bio|truncatechars:92 }}</p>
                </div>
                {% endif %} -->
            </div>
        </div>
        
        <!-- Permissions & Actions Section -->
        <div class="permissions-section">
            <h2 class="section-heading">Your Permissions & Actions</h2>
            
            <!-- Permission Rules Info -->
            <div class="permission-rules-card">
                <h3 class="rules-title">Permission Rules</h3>
                <div class="rules-content">
                    {% if user.access_level == '5' %}
                        <p class="rule-item"><strong>Head (Level 5):</strong> Full access - Can do everything including creating users, managing courses, publishing admission test results, clubs, and all administrative tasks.</p>
                    {% elif user.access_level == '4' %}
                        <p class="rule-item"><strong>Super Admin (Level 4):</strong> Can edit profile, manage courses, publish admission test results, create/manage clubs, and create new users of any level.</p>
                        {% if profile_type == 'officer' %}
                        <p class="rule-item"><strong>Officer with Super Admin:</strong> Can post notices, publish admission test results, create new users (any level), create clubs, and assign club conveners.</p>
                        {% endif %}
                    {% elif user.access_level == '3' %}
                        <p class="rule-item"><strong>Course Access (Level 3):</strong> Can edit profile, manage courses, and publish admission test results (available to both Faculty and Officers).</p>
                    {% elif user.access_level == '2' %}
                        <p class="rule-item"><strong>General User (Level 2):</strong> Can edit your own profile.</p>
                    {% elif user.access_level == '1' %}
                        <p class="rule-item"><strong>Club Member (Level 1):</strong> Basic access - Can edit your own profile.</p>
                    {% endif %}
                    
                    {% if profile_type == 'officer' and user.access_level != '4' %}
                        <p class="rule-item"><strong>Officer:</strong> Can post notices.</p>
                    {% endif %}
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="actions-grid">
                <!-- Edit Profile - Available to all -->
                <a href="{% url 'people:edit_profile' %}" class="action-card">
                    <div class="action-icon">‚úèÔ∏è</div>
                    <div class="action-content">
                        <h3 class="action-title">Edit Profile</h3>
                        <p class="action-desc">Update your personal information</p>
                    </div>
                </a>
                
                <!-- View Public Profile - Faculty only -->
                {% if profile_type == 'faculty' %}
                <a href="{% url 'people:faculty_detail' profile.pk %}" class="action-card">
                    <div class="action-icon">üëÅÔ∏è</div>
                    <div class="action-content">
                        <h3 class="action-title">View Public Profile</h3>
                        <p class="action-desc">See how your profile appears to others</p>
                    </div>
                </a>
                {% elif profile_type == 'officer' %}
                <a href="{% url 'people:officer_detail' profile.pk %}" class="action-card">
                    <div class="action-icon">üëÅÔ∏è</div>
                    <div class="action-content">
                        <h3 class="action-title">View Public Profile</h3>
                        <p class="action-desc">See how your profile appears to others</p>
                    </div>
                </a>
                {% endif %}
                
                <!-- Post Notices - Officers (Level 3+) -->
                {% if profile_type == 'officer' %}
                    {% if user.access_level == '3' or user.access_level == '4' or user.access_level == '5' %}
                    <a href="{% url 'office:create_post' %}?post_type=notice" class="action-card">
                        <div class="action-icon">üì¢</div>
                        <div class="action-content">
                            <h3 class="action-title">Post Notices</h3>
                            <p class="action-desc">Create and post new notices</p>
                        </div>
                    </a>
                    {% else %}
                    <div class="action-card action-disabled">
                        <div class="action-icon">üì¢</div>
                        <div class="action-content">
                            <h3 class="action-title">Post Notices</h3>
                            <p class="action-desc">Coming soon - Post announcements</p>
                        </div>
                    </div>
                    {% endif %}
                {% endif %}
                
                <!-- Manage Posts - Level 3+ -->
                {% if user.access_level == '3' or user.access_level == '4' or user.access_level == '5' %}
                <a href="{% url 'office:manage_posts' %}" class="action-card">
                    <div class="action-icon">üì¢</div>
                    <div class="action-content">
                        <h3 class="action-title">Manage Posts</h3>
                        <p class="action-desc">Create, edit, and manage posts and notices</p>
                    </div>
                </a>
                {% endif %}
                
                <!-- Manage Courses - Level 3+ -->
                {% if user.access_level == '3' or user.access_level == '4' or user.access_level == '5' %}
                <a href="{% url 'academics:manage_courses' %}" class="action-card">
                    <div class="action-icon">üìö</div>
                    <div class="action-content">
                        <h3 class="action-title">Manage Courses</h3>
                        <p class="action-desc">Edit, add, and manage course content</p>
                    </div>
                </a>
                {% endif %}
                
                <!-- Manage Routines - Level 3+ -->
                {% if user.access_level == '3' or user.access_level == '4' or user.access_level == '5' %}
                <a href="{% url 'office:manage_routines' %}" class="action-card">
                    <div class="action-icon">üìÖ</div>
                    <div class="action-content">
                        <h3 class="action-title">Manage Routines</h3>
                        <p class="action-desc">Create, edit, and manage class timetables</p>
                    </div>
                </a>
                {% endif %}
                
                <!-- Publish Admission Test Results - Level 3+ (Faculty and Officers) -->
                {% if user.access_level == '3' or user.access_level == '4' or user.access_level == '5' %}
                    {% if profile_type == 'faculty' or profile_type == 'officer' %}
                    <a href="{% url 'office:manage_admission_results' %}" class="action-card">
                        <div class="action-icon">üìã</div>
                        <div class="action-content">
                            <h3 class="action-title">Publish Admission Test Results</h3>
                            <p class="action-desc">Create and manage admission test results</p>
                        </div>
                    </a>
                    {% endif %}
                {% endif %}
                
                <!-- Manage Clubs - Level 4+ -->
                {% if user.access_level == '4' or user.access_level == '5' %}
                <div class="action-card action-disabled">
                    <div class="action-icon">üë•</div>
                    <div class="action-content">
                        <h3 class="action-title">Manage Clubs</h3>
                        <p class="action-desc">Coming soon - Create and manage clubs</p>
                    </div>
                </div>
                {% endif %}
                
                <!-- Create Users - Level 4+ -->
                {% if user.access_level == '4' or user.access_level == '5' %}
                <div class="action-card action-disabled">
                    <div class="action-icon">üë§</div>
                    <div class="action-content">
                        <h3 class="action-title">Create Users</h3>
                        <p class="action-desc">Coming soon - Add new users to the system</p>
                    </div>
                </div>
                {% endif %}
                
                <!-- Assign Club Convener - Officer with Level 4+ -->
                {% if profile_type == 'officer' %}
                    {% if user.access_level == '4' or user.access_level == '5' %}
                    <div class="action-card action-disabled">
                        <div class="action-icon">‚≠ê</div>
                        <div class="action-content">
                            <h3 class="action-title">Assign Club Convener</h3>
                            <p class="action-desc">Coming soon - Assign club leadership</p>
                        </div>
                    </div>
                    {% endif %}
                {% endif %}
            </div>
        </div>
    </section>
</div>

<style>
.user-profile-page {
    max-width: 1000px;
    margin: 0 auto;
    padding: 2rem 1rem;
}

.profile-header {
    margin-bottom: 2rem;
}

.back-link {
    color: var(--color-primary);
    text-decoration: none;
    font-weight: 500;
    transition: color 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
}

.back-link:hover {
    color: var(--color-primary-hover);
}

/* Profile Card */
.profile-card {
    background: var(--bg-secondary);
    border-radius: 20px;
    padding: 2.5rem;
    margin-bottom: 2rem;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    display: grid;
    grid-template-columns: 200px 1fr;
    gap: 2.5rem;
    align-items: start;
}

.profile-image-section {
    width: 200px;
    height: 200px;
    border-radius: 16px;
    overflow: hidden;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
    background: var(--bg-tertiary);
}

.profile-image-section img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
}

.profile-info-section {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

.profile-name-section {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.profile-name {
    font-size: 2rem;
    font-weight: 700;
    margin: 0;
    color: var(--text-primary);
    line-height: 1.2;
}

.profile-role {
    font-size: 1.1rem;
    color: var(--color-primary);
    font-weight: 600;
    margin: 0;
}

.profile-email {
    font-size: 0.9rem;
    color: var(--text-secondary);
    margin: 0;
}

/* Access Level Section */
.access-level-section {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
}

.access-level-badge,
.user-type-badge {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
    padding: 0.75rem 1.25rem;
    background: linear-gradient(135deg, 
        color-mix(in srgb, var(--color-primary) 10%, var(--bg-secondary)),
        color-mix(in srgb, var(--color-primary) 5%, var(--bg-secondary)));
    border-radius: 12px;
    border: 1px solid color-mix(in srgb, var(--color-primary) 20%, transparent);
}

.access-level-label,
.user-type-label {
    font-size: 0.7rem;
    color: var(--text-secondary);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.access-level-value,
.user-type-value {
    font-size: 1rem;
    color: var(--color-primary);
    font-weight: 700;
}

/* Quick Info Grid */
.quick-info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 0.75rem;
}

.quick-info-item {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
    padding: 0.75rem 1rem;
    background: var(--bg-tertiary);
    border-radius: 10px;
    border: 1px solid var(--border-color);
}

.quick-info-label {
    font-size: 0.7rem;
    color: var(--text-secondary);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.quick-info-value {
    font-size: 1rem;
    color: var(--text-primary);
    font-weight: 600;
}

/* Bio */
.profile-bio {
    padding: 1rem;
    background: var(--bg-tertiary);
    border-radius: 12px;
    border-left: 3px solid var(--color-primary);
}

.profile-bio p {
    margin: 0;
    font-size: 0.95rem;
    line-height: 1.6;
    color: var(--text-primary);
}

/* Permissions Section */
.permissions-section {
    margin-top: 2rem;
}

.section-heading {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--text-primary);
    margin: 0 0 1.5rem 0;
}

/* Permission Rules Card */
.permission-rules-card {
    background: linear-gradient(135deg, 
        color-mix(in srgb, var(--color-primary) 8%, var(--bg-secondary)),
        color-mix(in srgb, var(--color-primary) 4%, var(--bg-secondary)));
    border-radius: 16px;
    padding: 1.5rem;
    margin-bottom: 2rem;
    border: 1px solid color-mix(in srgb, var(--color-primary) 15%, transparent);
}

.rules-title {
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--color-primary);
    margin: 0 0 1rem 0;
}

.rules-content {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.rule-item {
    margin: 0;
    font-size: 0.9rem;
    line-height: 1.6;
    color: var(--text-primary);
    padding-left: 1rem;
    position: relative;
}

.rule-item::before {
    content: '‚Ä¢';
    position: absolute;
    left: 0;
    color: var(--color-primary);
    font-weight: bold;
}

/* Actions Grid */
.actions-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 1.25rem;
}

.action-card {
    background: var(--bg-secondary);
    border-radius: 16px;
    padding: 1.5rem;
    border: 2px solid var(--border-color);
    text-decoration: none;
    color: inherit;
    display: flex;
    gap: 1rem;
    align-items: start;
    transition: all 0.3s ease;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
}

.action-card:not(.action-disabled):hover {
    border-color: var(--color-primary);
    transform: translateY(-4px);
    box-shadow: 0 8px 24px color-mix(in srgb, var(--color-primary) 20%, transparent);
}

.action-card.action-disabled {
    opacity: 0.6;
    cursor: not-allowed;
    position: relative;
}

.action-icon {
    font-size: 2rem;
    flex-shrink: 0;
    line-height: 1;
}

.action-content {
    flex: 1;
}

.action-title {
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--text-primary);
    margin: 0 0 0.5rem 0;
}

.action-desc {
    font-size: 0.85rem;
    color: var(--text-secondary);
    margin: 0;
    line-height: 1.5;
}

/* Responsive */
@media (max-width: 768px) {
    .profile-card {
        grid-template-columns: 1fr;
        padding: 1.5rem;
        gap: 1.5rem;
    }
    
    .profile-image-section {
        width: 150px;
        height: 150px;
        margin: 0 auto;
    }
    
    .profile-name {
        font-size: 1.5rem;
        text-align: center;
    }
    
    .profile-role {
        text-align: center;
    }
    
    .access-level-section {
        justify-content: center;
    }
    
    .actions-grid {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 480px) {
    .user-profile-page {
        padding: 1rem 0.5rem;
    }
    
    .profile-card {
        padding: 1.25rem;
    }
    
    .quick-info-grid {
        grid-template-columns: 1fr;
    }
}
</style>
{% endblock %}
