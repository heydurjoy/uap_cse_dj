{% extends 'base.html' %}
{% load static %}
{% load user_filters %}

{% block title %}Departmental Research - CSE UAP{% endblock %}

{% block content %}
<div class="container">
    <section class="research-page-section">
        <!-- Header -->
        <div class="research-header">
            <div class="header-content">
                <div class="header-text">
                    <h1>Departmental Research</h1>
                    <p class="subtitle">Publications and research contributions from our faculty members</p>
                </div>
                <a href="{% url 'people:faculty_list' %}" class="back-link">
                    ← Back to Faculty
                </a>
            </div>
        </div>

        <!-- Time Period Filter Bar -->
        <div class="period-filter-bar">
            <div class="filter-label">Time Period:</div>
            <div class="filter-buttons">
                <a href="?period=all_time&tab={{ request.GET.tab|default:'stats' }}" class="filter-btn {% if period == 'all_time' %}active{% endif %}" data-period="all_time">
                    All Time
                </a>
                <a href="?period=last_2_years&tab={{ request.GET.tab|default:'stats' }}" class="filter-btn {% if period == 'last_2_years' %}active{% endif %}" data-period="last_2_years">
                    Last 2 Years
                </a>
                <a href="?period=current_year&tab={{ request.GET.tab|default:'stats' }}" class="filter-btn {% if period == 'current_year' %}active{% endif %}" data-period="current_year">
                    {{ current_year }}
                </a>
            </div>
        </div>

        <!-- Tabs Navigation -->
        <div class="tabs-container">
            <div class="tabs-nav">
                <button class="tab-btn {% if request.GET.tab != 'faculty' and request.GET.tab != 'publications' %}active{% endif %}" data-tab="stats">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="20" x2="18" y2="10"></line>
                        <line x1="12" y1="20" x2="12" y2="4"></line>
                        <line x1="6" y1="20" x2="6" y2="14"></line>
                    </svg>
                    Statistics
                </button>
                <button class="tab-btn {% if request.GET.tab == 'faculty' %}active{% endif %}" data-tab="faculty">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                        <circle cx="9" cy="7" r="4"></circle>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                    </svg>
                    Faculty Scores
                </button>
                <button class="tab-btn {% if request.GET.tab == 'publications' %}active{% endif %}" data-tab="publications">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                        <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
                    </svg>
                    All Publications
                </button>
            </div>

            <!-- Tab Content -->
            <!-- Statistics Tab -->
            <div class="tab-content {% if request.GET.tab != 'faculty' and request.GET.tab != 'publications' %}active{% endif %}" id="stats-tab">
                <div class="stats-section">
            <h2 class="section-title">Statistics</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value">{{ total_pubs }}</div>
                    <div class="stat-label">Total Publications</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">{{ total_citations|floatformat:0 }}</div>
                    <div class="stat-label">Total Citations</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">{{ avg_pubs_per_faculty }}</div>
                    <div class="stat-label">Avg. Publications per Faculty</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">{{ num_faculty }}</div>
                    <div class="stat-label">Current Faculty Members</div>
                </div>
            </div>

            <!-- Ranking Breakdown -->
            <div class="ranking-stats">
                <h3 class="subsection-title">Publications by Ranking</h3>
                <div class="ranking-grid">
                    {% for ranking_code, data in stats_by_ranking.items %}
                    <div class="ranking-card">
                        <div class="ranking-label">{{ data.label }}</div>
                        <div class="ranking-value">{{ data.count }}</div>
                        <div class="ranking-score">Score: {{ data.score }}</div>
                    </div>
                    {% endfor %}
                </div>
            </div>
                </div>
            </div>

            <!-- Faculty Scores Tab -->
            <div class="tab-content {% if request.GET.tab == 'faculty' %}active{% endif %}" id="faculty-tab">
                <div class="faculty-scores-section">
                    <!-- Faculty Tabs -->
                    <div class="faculty-view-tabs">
                        <div class="faculty-tab-buttons">
                            <button class="faculty-tab-btn active" data-faculty-tab="all-faculties">
                                All Faculties
                                <button class="faculty-tab-info-btn" title="View all faculty members" onclick="event.stopPropagation(); openFacultyTabInfoModal('all-faculties')">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                                        <line x1="12" y1="17" x2="12.01" y2="17"></line>
                                    </svg>
                                </button>
                            </button>
                            <button class="faculty-tab-btn" data-faculty-tab="most-cited">
                                Most Cited
                                <button class="faculty-tab-info-btn" title="How are most cited researchers selected?" onclick="event.stopPropagation(); openFacultyTabInfoModal('most-cited')">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                                        <line x1="12" y1="17" x2="12.01" y2="17"></line>
                                    </svg>
                                </button>
                            </button>
                            <button class="faculty-tab-btn" data-faculty-tab="leading-active">
                                Leading Active
                                <button class="faculty-tab-info-btn" title="How are leading active researchers selected?" onclick="event.stopPropagation(); openFacultyTabInfoModal('leading-active')">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                                        <line x1="12" y1="17" x2="12.01" y2="17"></line>
                                    </svg>
                                </button>
                            </button>
                            <button class="faculty-tab-btn" data-faculty-tab="top-designation">
                                Top by Designation
                                <button class="faculty-tab-info-btn" title="How are top researchers by designation selected?" onclick="event.stopPropagation(); openFacultyTabInfoModal('top-designation')">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                                        <line x1="12" y1="17" x2="12.01" y2="17"></line>
                                    </svg>
                                </button>
                            </button>
                        </div>
                        
                        <!-- Tab 1: All Faculties -->
                        <div class="faculty-tab-content active" id="all-faculties-tab">
                            <div class="faculty-cards-grid">
                                {% for item in faculty_scores %}
                                <a href="{% url 'people:faculty_detail' item.faculty.pk %}" class="faculty-card-item">
                                    <div class="faculty-card {% if item.badges %}has-badges{% endif %}">
                                        <div class="faculty-card-image">
                                            <img src="{% if item.faculty.profile_pic %}/media/{{ item.faculty.profile_pic.name }}{% else %}{% static 'defaults/people.png' %}{% endif %}" alt="{{ item.faculty.name }}">
                                            {% if item.badges %}
                                            <div class="faculty-badges">
                                                {% if 'most_cited' in item.badges %}
<span class="faculty-badge badge-most-cited" title="Top 4 Most Cited">
  <i class="fa-solid fa-star"></i>
</span>
{% endif %}

{% if 'leading_active' in item.badges %}
<span class="faculty-badge badge-leading-active" title="Top 4 Leading Active">
  <i class="fa-solid fa-bolt"></i>
</span>
{% endif %}

                                                {% if 'top_designation' in item.badges %}
                                                <span class="faculty-badge badge-top-designation" title="Top by Designation">
                                                      <i class="fa-solid fa-trophy"></i>
                                                   </span>

                                                {% endif %}
                                            </div>
                                            {% endif %}
                                            <div class="faculty-card-overlay">
                                                <div class="faculty-card-info">
                                                    <div class="faculty-card-header">
                                                        <span class="faculty-card-sl">#{{ item.faculty.sl|default:"-" }}</span>
                                                        <h3 class="faculty-card-name">{{ item.faculty.name }}</h3>
                                                    </div>
                                                    <div class="faculty-card-meta">
                                                        <span class="faculty-card-score">Score: {{ item.score }}</span>
                                                        <span class="faculty-card-citation">Citations: {{ item.citations|floatformat:0 }}</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </a>
                                {% empty %}
                                <p class="empty-message">No faculty found.</p>
                                {% endfor %}
                            </div>
                        </div>
                        
                        <!-- Tab 2: Most Cited -->
                        <div class="faculty-tab-content" id="most-cited-tab">
                            <div class="faculty-cards-grid">
                                {% for item in all_faculty_most_cited %}
                                <a href="{% url 'people:faculty_detail' item.faculty.pk %}" class="faculty-card-item">
                                    <div class="faculty-card {% if item.is_top_4 %}golden-rank{% endif %}">
                                        <div class="faculty-card-image">
                                            <img src="{% if item.faculty.profile_pic %}/media/{{ item.faculty.profile_pic.name }}{% else %}{% static 'defaults/people.png' %}{% endif %}" alt="{{ item.faculty.name }}">
                                            <div class="faculty-card-overlay">
                                                <div class="faculty-card-info">
                                                    <h3 class="faculty-card-name">{{ item.faculty.name }}</h3>
                                                    <div class="faculty-card-meta">
                                                        <span class="faculty-card-citation">Citations: {{ item.citations|floatformat:0 }}</span>
                                                        <span class="faculty-card-score">Score: {{ item.score }}</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        {% if item.is_top_4 %}
                                        <div class="golden-rank-badge-below">Top 4</div>
                                        {% endif %}
                                    </div>
                                </a>
                                {% empty %}
                                <p class="empty-message">No faculty found.</p>
                                {% endfor %}
                            </div>
                        </div>
                        
                        <!-- Tab 3: Leading Active -->
                        <div class="faculty-tab-content" id="leading-active-tab">
                            <div class="faculty-cards-grid">
                                {% for item in all_faculty_leading_active %}
                                <a href="{% url 'people:faculty_detail' item.faculty.pk %}" class="faculty-card-item">
                                    <div class="faculty-card {% if item.is_top_4 %}golden-rank{% endif %}">
                                        <div class="faculty-card-image">
                                            <img src="{% if item.faculty.profile_pic %}/media/{{ item.faculty.profile_pic.name }}{% else %}{% static 'defaults/people.png' %}{% endif %}" alt="{{ item.faculty.name }}">
                                            <div class="faculty-card-overlay">
                                                <div class="faculty-card-info">
                                                    <h3 class="faculty-card-name">{{ item.faculty.name }}</h3>
                                                    <div class="faculty-card-meta">
                                                        <span class="faculty-card-score">Score: {{ item.score }}</span>
                                                        <span class="faculty-card-pubs">Pubs (2yr): {{ item.publication_count }}</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        {% if item.is_top_4 %}
                                        <div class="golden-rank-badge-below">Top 4</div>
                                        {% endif %}
                                    </div>
                                </a>
                                {% empty %}
                                <p class="empty-message">No faculty found.</p>
                                {% endfor %}
                            </div>
                        </div>
                        
                        <!-- Tab 4: Top by Designation -->
                        <div class="faculty-tab-content" id="top-designation-tab">
                            <div class="faculty-cards-grid">
                                {% for item in all_faculty_designation_wise %}
                                <a href="{% url 'people:faculty_detail' item.faculty.pk %}" class="faculty-card-item">
                                    <div class="faculty-card {% if item.is_top_1 %}golden-rank{% endif %}">
                                        <div class="faculty-card-image">
                                            <img src="{% if item.faculty.profile_pic %}/media/{{ item.faculty.profile_pic.name }}{% else %}{% static 'defaults/people.png' %}{% endif %}" alt="{{ item.faculty.name }}">
                                            <div class="faculty-card-overlay">
                                                <div class="faculty-card-info">
                                                    <h3 class="faculty-card-name">{{ item.faculty.name }}</h3>
                                                    <div class="faculty-card-meta">
                                                        <span class="faculty-card-score">Score: {{ item.score }}</span>
                                                        <span class="faculty-card-citation">Citations: {{ item.citations|floatformat:0 }}</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="faculty-card-designation">{{ item.designation }}</div>
                                        {% if item.is_top_1 %}
                                        <div class="golden-rank-badge-below">Top in {{ item.designation }}</div>
                                        {% endif %}
                                    </div>
                                </a>
                                {% empty %}
                                <p class="empty-message">No faculty found.</p>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Publications Tab -->
            <div class="tab-content {% if request.GET.tab == 'publications' %}active{% endif %}" id="publications-tab">
                <div class="publications-section">
                    <h2 class="section-title">All Publications</h2>
                    <div class="publications-table-container">
                        <table class="publications-table">
                            <thead>
                                <tr>
                                    <th>Title</th>
                                    <th>Year</th>
                                    <th>Type</th>
                                    <th>Ranking</th>
                                    <th>Faculty</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for pub in publications %}
                                <tr>
                                    <td class="title-cell">{{ pub.title }}</td>
                                    <td>{{ pub.pub_year }}</td>
                                    <td>
                                        <span class="type-badge type-{{ pub.type }}">
                                            {{ pub.get_type_display }}
                                        </span>
                                    </td>
                                    <td>
                                        <span class="ranking-badge ranking-{{ pub.ranking }}">
                                            {{ pub.get_ranking_display }}
                                        </span>
                                    </td>
                                    <td>
                                        <a href="{% url 'people:faculty_detail' pub.faculty.pk %}" class="faculty-link">
                                            {{ pub.faculty.name }}
                                        </a>
                                    </td>
                                    <td>
                                        {% if pub.link %}
                                        <a href="{{ pub.link }}" target="_blank" rel="noopener noreferrer" class="read-paper-btn">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                                                <polyline points="15 3 21 3 21 9"></polyline>
                                                <line x1="10" y1="14" x2="21" y2="3"></line>
                                            </svg>
                                            Read Paper
                                        </a>
                                        {% else %}
                                        <span class="no-link">—</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="6" class="empty-message">No publications found for the selected period.</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>

<style>
.research-page-section {
    max-width: 1400px;
    margin: 0 auto;
    padding: 2rem 1rem;
}

.research-header {
    margin-bottom: 2rem;
}

.header-content {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    flex-wrap: wrap;
    gap: 1rem;
}

.header-text h1 {
    font-size: 2.5rem;
    font-weight: 700;
    color: var(--color-primary);
    margin: 0 0 0.5rem 0;
    background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-hover) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.subtitle {
    color: var(--text-secondary);
    font-size: 1.1rem;
    margin: 0;
}

.back-link {
    color: var(--color-primary);
    text-decoration: none;
    font-weight: 500;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    border-radius: 8px;
    border: 2px solid var(--border-color);
    transition: all 0.2s ease;
}

.back-link:hover {
    border-color: var(--color-primary);
    background: color-mix(in srgb, var(--color-primary) 5%, transparent);
}

/* Period Filter Bar */
.period-filter-bar {
    background: var(--bg-secondary);
    border: 1px solid var(--border-color);
    border-radius: 12px;
    padding: 1rem 1.5rem;
    margin-bottom: 2rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    flex-wrap: wrap;
}

.filter-label {
    font-weight: 600;
    color: var(--text-primary);
}

.filter-buttons {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
}

.filter-btn {
    padding: 0.5rem 1.25rem;
    border-radius: 8px;
    text-decoration: none;
    font-weight: 500;
    color: var(--text-secondary);
    background: var(--bg-tertiary);
    border: 2px solid var(--border-color);
    transition: all 0.2s ease;
}

.filter-btn:hover {
    border-color: var(--color-primary);
    color: var(--color-primary);
}

.filter-btn.active {
    background: var(--color-primary);
    color: white;
    border-color: var(--color-primary);
}

/* Statistics Section */
.stats-section {
    margin-bottom: 3rem;
}

.section-title {
    font-size: 1.75rem;
    font-weight: 700;
    color: var(--text-primary);
    margin: 0 0 1.5rem 0;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin-bottom: 2rem;
}

.stat-card {
    background: var(--bg-secondary);
    border: 1px solid var(--border-color);
    border-radius: 12px;
    padding: 1.5rem;
    text-align: center;
}

.stat-value {
    font-size: 2.5rem;
    font-weight: 700;
    color: var(--color-primary);
    margin-bottom: 0.5rem;
}

.stat-label {
    font-size: 0.9rem;
    color: var(--text-secondary);
    font-weight: 500;
}

.subsection-title {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--text-primary);
    margin: 2rem 0 1rem 0;
}

.ranking-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 1rem;
}

.ranking-card {
    background: var(--bg-secondary);
    border: 1px solid var(--border-color);
    border-radius: 10px;
    padding: 1rem;
    text-align: center;
}

.ranking-label {
    font-size: 0.85rem;
    color: var(--text-secondary);
    margin-bottom: 0.5rem;
    font-weight: 500;
}

.ranking-value {
    font-size: 1.75rem;
    font-weight: 700;
    color: var(--color-primary);
    margin-bottom: 0.25rem;
}

.ranking-score {
    font-size: 0.75rem;
    color: var(--text-secondary);
}

/* Faculty Scores Section */
.faculty-scores-section {
    margin-bottom: 3rem;
}

.scores-table-container {
    background: var(--bg-secondary);
    border: 1px solid var(--border-color);
    border-radius: 12px;
    overflow: hidden;
}

.scores-table {
    width: 100%;
    border-collapse: collapse;
}

.scores-table thead {
    background: var(--bg-tertiary);
}

.scores-table th {
    padding: 1rem;
    text-align: left;
    font-weight: 600;
    color: var(--text-primary);
    border-bottom: 2px solid var(--border-color);
}

.scores-table td {
    padding: 1rem;
    border-bottom: 1px solid var(--border-color);
    color: var(--text-primary);
}

.scores-table tbody tr:hover {
    background: color-mix(in srgb, var(--color-primary) 3%, transparent);
}

.rank-cell {
    font-weight: 600;
    color: var(--text-secondary);
}

.top-rank {
    color: var(--color-primary);
    font-size: 1.1rem;
}

.faculty-link {
    color: var(--color-primary);
    text-decoration: none;
    font-weight: 500;
}

.faculty-link:hover {
    text-decoration: underline;
}

.score-cell {
    font-weight: 700;
    color: var(--color-primary);
    font-size: 1.1rem;
}

/* Publications Section */
.publications-section {
    margin-bottom: 3rem;
}

.publications-table-container {
    background: var(--bg-secondary);
    border: 1px solid var(--border-color);
    border-radius: 12px;
    overflow-x: auto;
}

.publications-table {
    width: 100%;
    border-collapse: collapse;
    min-width: 800px;
}

.publications-table thead {
    background: var(--bg-tertiary);
}

.publications-table th {
    padding: 1rem;
    text-align: left;
    font-weight: 600;
    color: var(--text-primary);
    border-bottom: 2px solid var(--border-color);
    white-space: nowrap;
}

.publications-table td {
    padding: 1rem;
    border-bottom: 1px solid var(--border-color);
    color: var(--text-primary);
}

.publications-table tbody tr:hover {
    background: color-mix(in srgb, var(--color-primary) 3%, transparent);
}

.title-cell {
    max-width: 400px;
    word-wrap: break-word;
}

.type-badge,
.ranking-badge {
    display: inline-block;
    padding: 0.25rem 0.75rem;
    border-radius: 6px;
    font-size: 0.85rem;
    font-weight: 600;
}

.type-journal {
    background: color-mix(in srgb, #3b82f6 15%, transparent);
    color: #3b82f6;
    border: 1px solid color-mix(in srgb, #3b82f6 30%, transparent);
}

.type-conf {
    background: color-mix(in srgb, #10b981 15%, transparent);
    color: #10b981;
    border: 1px solid color-mix(in srgb, #10b981 30%, transparent);
}

.type-bookchapter {
    background: color-mix(in srgb, #8b5cf6 15%, transparent);
    color: #8b5cf6;
    border: 1px solid color-mix(in srgb, #8b5cf6 30%, transparent);
}

.type-other {
    background: color-mix(in srgb, #6b7280 15%, transparent);
    color: #6b7280;
    border: 1px solid color-mix(in srgb, #6b7280 30%, transparent);
}

.ranking-q1 {
    background: color-mix(in srgb, #10b981 15%, transparent);
    color: #10b981;
    border: 1px solid color-mix(in srgb, #10b981 30%, transparent);
}

.ranking-q2 {
    background: color-mix(in srgb, #3b82f6 15%, transparent);
    color: #3b82f6;
    border: 1px solid color-mix(in srgb, #3b82f6 30%, transparent);
}

.ranking-q3 {
    background: color-mix(in srgb, #f59e0b 15%, transparent);
    color: #f59e0b;
    border: 1px solid color-mix(in srgb, #f59e0b 30%, transparent);
}

.ranking-q4 {
    background: color-mix(in srgb, #ef4444 15%, transparent);
    color: #ef4444;
    border: 1px solid color-mix(in srgb, #ef4444 30%, transparent);
}

.ranking-a_star,
.ranking-a,
.ranking-b,
.ranking-c {
    background: color-mix(in srgb, #8b5cf6 15%, transparent);
    color: #8b5cf6;
    border: 1px solid color-mix(in srgb, #8b5cf6 30%, transparent);
}

.ranking-not_indexed {
    background: color-mix(in srgb, #6b7280 15%, transparent);
    color: #6b7280;
    border: 1px solid color-mix(in srgb, #6b7280 30%, transparent);
}

.read-paper-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.4rem;
    padding: 0.4rem 0.75rem;
    background: var(--color-primary);
    color: white;
    text-decoration: none;
    border-radius: 6px;
    font-size: 0.85rem;
    font-weight: 500;
    transition: all 0.2s ease;
}

.read-paper-btn:hover {
    background: var(--color-primary-hover);
    transform: translateY(-1px);
    box-shadow: 0 2px 8px color-mix(in srgb, var(--color-primary) 30%, transparent);
}

.no-link {
    color: var(--text-secondary);
    font-style: italic;
}

.empty-message {
    text-align: center;
    padding: 2rem;
    color: var(--text-secondary);
    font-style: italic;
}

/* Faculty View Tabs */
.faculty-view-tabs {
    margin-top: 2rem;
}

.faculty-tab-buttons {
    display: flex;
    justify-content: center;
    gap: 0;
    margin-bottom: 2rem;
    border-bottom: 2px solid var(--border-color);
    flex-wrap: wrap;
}

.faculty-tab-btn {
    padding: 0.875rem 1.75rem;
    background: transparent;
    border: none;
    border-bottom: 3px solid transparent;
    color: var(--text-secondary);
    font-size: 0.95rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
    margin-bottom: -2px;
    position: relative;
    border-radius: 8px 8px 0 0;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.faculty-tab-info-btn {
    background: transparent;
    border: none;
    border-radius: 50%;
    width: 20px;
    height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    color: var(--text-secondary);
    padding: 0;
    flex-shrink: 0;
}

.faculty-tab-info-btn svg {
    width: 14px;
    height: 14px;
}

.faculty-tab-info-btn:hover {
    background: color-mix(in srgb, var(--color-primary) 10%, transparent);
    color: var(--color-primary);
    transform: scale(1.1);
}

.faculty-tab-btn.active .faculty-tab-info-btn {
    color: var(--color-primary);
}

.faculty-tab-btn:hover {
    color: var(--color-primary);
    background: color-mix(in srgb, var(--color-primary) 5%, transparent);
}

.faculty-tab-btn.active {
    color: var(--color-primary);
    border-bottom-color: var(--color-primary);
    font-weight: 600;
    background: color-mix(in srgb, var(--color-primary) 3%, transparent);
}

.faculty-tab-content {
    display: none;
}

.faculty-tab-content.active {
    display: block;
    animation: fadeInSlide 0.4s ease;
}

@keyframes fadeInSlide {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Faculty Cards Grid - 4 per row */
.faculty-cards-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1.5rem;
    margin-top: 1rem;
}

@media (max-width: 1200px) {
    .faculty-cards-grid {
        grid-template-columns: repeat(3, 1fr);
    }
}

@media (max-width: 900px) {
    .faculty-cards-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}

.faculty-card-item{
    text-decoration: none;
    color: inherit;
    display: block;
    transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
    transform-origin: center bottom;
    transform-style: preserve-3d;
    will-change: transform;
    position: relative;
    overflow: visible;
    perspective: 1200px;
    perspective-origin: 50% 100%;
}

.faculty-card {
    background: var(--bg-secondary);
    border: 1px solid var(--border-color);
    border-radius: 16px;
    padding: 0;
    display: flex;
    flex-direction: column;
    position: relative;
    overflow: hidden;
    cursor: pointer;
    height: 100%;
    min-height: 280px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
    transform-style: preserve-3d;
    transform: rotateX(0deg) rotateY(0deg) rotateZ(0deg);
}

/* Apple-like hover: scale up and tilt the card backward (leaning back) - straight, no side rotation */
.faculty-card-item:hover {
    transform: scale(1.08) translateY(-8px) rotateX(12deg) rotateY(0deg) rotateZ(0deg);
    z-index: 100;
    transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
}

.faculty-card-item:hover .faculty-card {
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.25);
    border-color: var(--color-primary);
    border-width: 2px;
}
.faculty-card-image {
    width: 100%;
    height: 100%;
    min-height: 280px;
    position: relative;
    overflow: hidden;
    border-radius: 16px;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.faculty-card-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.faculty-card-item:hover .faculty-card-image img {
    transform: scale(1.05);
    transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
}
.faculty-cards-grid:hover .faculty-card-item:not(:hover) {
    transform: scale(0.92);
    opacity: 0.6;
    filter: blur(2px);
    transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
}
.faculty-badges {
    position: absolute;
    top: 0.5rem;
    right: 0.5rem;
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
    z-index: 10;
}

.faculty-badge {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 2rem;
    height: 2rem;
    border-radius: 50%;
    background: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(4px);
    font-size: 1rem;
    color: white;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
    transition: all 0.3s ease;
}

.faculty-card-item:hover .faculty-badge {
    transform: scale(1.1);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
}
.badge-most-cited i {
  color: #f4c430; /* gold */
}

.badge-leading-active i {
  color: #ff5a3c; /* energetic */
}
.golden-rank-badge-below {
    background: transparent;
    padding: 0.5rem 0.75rem;
    font-size: 0.8rem;
    font-weight: 700;
    text-align: center;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    position: absolute;
    bottom: 0.5rem;
    left: 0;
    right: 0;
    z-index: 4;
    margin-bottom: 1.5rem;
    pointer-events: none;

    /* Gradient text using theme colors */
    background: linear-gradient(
        90deg,
        var(--color-primary),
        color-mix(in srgb, var(--color-primary) 70%, white 30%),
        color-mix(in srgb, var(--color-primary) 50%, white 50%)
    );
    background-size: 200% 200%;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;

    /* Subtle shadow */
    text-shadow: 0 2px 4px rgba(0,0,0,0.3),
                 0 0 6px color-mix(in srgb, var(--color-primary) 60%, transparent);

    /* Animation */
    animation: gradientSlide 4s ease-in-out infinite, badgePulse 3s ease-in-out infinite alternate;
}

@keyframes gradientSlide {
    0% {
        background-position: 0% 50%;
    }
    50% {
        background-position: 100% 50%;
    }
    100% {
        background-position: 0% 50%;
    }
}

@keyframes badgePulse {
    0%, 100% {
        transform: scale(1);
    }
    50% {
        transform: scale(1.05);
    }
}

.faculty-card-designation {

    color: var(--text-secondary);
    padding: 0.5rem 0.75rem;
    font-size: 0.75rem;
    font-weight: 600;
    text-align: center;
    border-top: 1px solid var(--border-color);
}

.faculty-card-overlay {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: linear-gradient(to top, rgba(0, 0, 0, 0.85) 0%, rgba(0, 0, 0, 0.7) 50%, rgba(0, 0, 0, 0) 100%);
    padding: 1.25rem 1rem 1rem 1rem;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.faculty-card-item:hover .faculty-card-overlay {
    padding: 1.5rem 1.25rem 1.25rem 1.25rem;
    background: linear-gradient(to top, rgba(0, 0, 0, 0.9) 0%, rgba(0, 0, 0, 0.75) 50%, rgba(0, 0, 0, 0) 100%);
}


.faculty-card-info {
    display: flex;
    flex-direction: column;
    gap: 0.4rem;
}
.faculty-badge i {
  font-size: 0.9rem;
  color: gold;
}

.faculty-card-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    flex-wrap: wrap;
}

.faculty-card-sl {
    font-size: 0.75rem;
    font-weight: 600;
    color: rgba(255, 255, 255, 0.8);
    background: rgba(0, 0, 0, 0.3);
    padding: 0.25rem 0.5rem;
    border-radius: 6px;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    flex-shrink: 0;
}

.faculty-card-name {
    font-size: 1.1rem;
    font-weight: 700;
    margin: 0;
    color: white;
    line-height: 1.2;
    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
    flex: 1;
}

.faculty-card-meta {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
}

.faculty-card-score,
.faculty-card-citation,
.faculty-card-pubs {
    font-size: 0.85rem;
    color: rgba(255, 255, 255, 0.9);
    font-weight: 500;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
}

/* Top Researchers Cards */
.researcher-section {
    margin-bottom: 3rem;
}

.researcher-section-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--color-primary);
    margin: 0 0 1.5rem 0;
    text-align: center;
    padding-bottom: 0.75rem;
    border-bottom: 2px solid var(--border-color);
}

.top-researchers-list {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: 1.5rem;
}

.designation-title-small {
    font-size: 1rem;
    font-weight: 700;
    color: var(--color-primary);
    margin: 0.75rem 0 0 0;
    text-align: center;
    padding: 0;
    border: none;
}

.top-researcher-item {
    text-decoration: none;
    color: inherit;
    display: flex;
    flex-direction: column;
    align-items: center;
    transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
    transform-origin: center bottom;
    transform-style: preserve-3d;
    will-change: transform;
    position: relative;
    overflow: visible;
    perspective: 1200px;
    perspective-origin: 50% 100%;
}

.top-researcher-item:hover {
    transform: scale(1.08) translateY(-8px) rotateX(12deg) rotateY(0deg) rotateZ(0deg);
    z-index: 100;
    transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
}

.researcher-card {
    background: var(--bg-secondary);
    border: 1px solid var(--border-color);
    border-radius: 16px;
    padding: 0;
    display: flex;
    flex-direction: column;
    position: relative;
    overflow: hidden;
    cursor: pointer;
    height: 100%;
    min-height: 280px;
    width: 200px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
    transform-style: preserve-3d;
    transform: rotateX(0deg) rotateY(0deg) rotateZ(0deg);
}

.top-researcher-item:hover .researcher-card {
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.25);
    border-color: var(--color-primary);
    border-width: 2px;
}

.researcher-card-image {
    width: 100%;
    height: 100%;
    min-height: 280px;
    position: relative;
    overflow: hidden;
    border-radius: 16px;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.researcher-card-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.top-researcher-item:hover .researcher-card-image img {
    transform: scale(1.05);
    transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
}

.researcher-card-overlay {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: linear-gradient(to top, rgba(0, 0, 0, 0.85) 0%, rgba(0, 0, 0, 0.7) 50%, rgba(0, 0, 0, 0) 100%);
    padding: 1.25rem 1rem 1rem 1rem;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.top-researcher-item:hover .researcher-card-overlay {
    padding: 1.5rem 1.25rem 1.25rem 1.25rem;
    background: linear-gradient(to top, rgba(0, 0, 0, 0.9) 0%, rgba(0, 0, 0, 0.75) 50%, rgba(0, 0, 0, 0) 100%);
}

.researcher-card-info {
    display: flex;
    flex-direction: column;
    gap: 0.4rem;
    position: relative;
}

.researcher-name {
    font-size: 1.1rem;
    font-weight: 700;
    margin: 0;
    color: white;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    line-height: 1.2;
    display: -webkit-box;
    -webkit-line-clamp: 1;
    -webkit-box-orient: vertical;
    overflow: hidden;
    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
}

.top-researcher-item:hover .researcher-name {
    font-size: 1.2rem;
}

.researcher-meta {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    flex-wrap: wrap;
    margin: 0;
}

.researcher-score,
.researcher-citation,
.researcher-pubs {
    font-size: 0.85rem;
    font-weight: 600;
    color: rgba(255, 255, 255, 0.95);
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
}

.researcher-score,
.researcher-citation,
.researcher-pubs {
    font-size: 0.8rem;
    color: rgba(255, 255, 255, 0.9);
    margin: 0;
    font-weight: 500;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    line-height: 1.2;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
}

.top-researcher-item:hover .researcher-score,
.top-researcher-item:hover .researcher-citation,
.top-researcher-item:hover .researcher-pubs {
    font-size: 0.85rem;
}

/* Section Header with Info Button */
.section-header-with-info {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 1.5rem;
    gap: 1rem;
}

.info-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: var(--bg-tertiary);
    border: 2px solid var(--border-color);
    color: var(--text-secondary);
    cursor: pointer;
    transition: all 0.2s ease;
    padding: 0;
}

.info-btn:hover {
    background: var(--color-primary);
    border-color: var(--color-primary);
    color: white;
    transform: scale(1.1);
}

.info-btn svg {
    width: 20px;
    height: 20px;
}

/* Info Modal */
.info-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    z-index: 1000;
    align-items: center;
    justify-content: center;
    padding: 1rem;
}

.info-modal.active {
    display: flex;
}

.info-modal-content {
    background: var(--bg-secondary);
    border-radius: 16px;
    padding: 2rem;
    max-width: 600px;
    width: 100%;
    max-height: 90vh;
    overflow-y: auto;
    border: 1px solid var(--border-color);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    position: relative;
}

.info-modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
}

.info-modal-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--text-primary);
    margin: 0;
}

.info-modal-close {
    background: transparent;
    border: none;
    color: var(--text-secondary);
    cursor: pointer;
    padding: 0.5rem;
    border-radius: 8px;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
}

.info-modal-close:hover {
    background: var(--bg-tertiary);
    color: var(--text-primary);
}

.info-modal-close svg {
    width: 24px;
    height: 24px;
}

.scoring-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 1rem;
}

.scoring-table th,
.scoring-table td {
    padding: 0.75rem;
    text-align: left;
    border-bottom: 1px solid var(--border-color);
}

.scoring-table th {
    background: var(--bg-tertiary);
    font-weight: 600;
    color: var(--text-primary);
}

.scoring-table td {
    color: var(--text-secondary);
}

.scoring-table tr:last-child td {
    border-bottom: none;
}

.scoring-explanation {
    margin-top: 1.5rem;
    padding: 1rem;
    background: color-mix(in srgb, var(--color-primary) 8%, transparent);
    border-radius: 10px;
}

/* Faculty Tab Info Modal Styles */
.info-modal-home {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.6);
    z-index: 10000;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(4px);
}

.info-modal-home.active {
    display: flex;
}

.info-modal-content-home {
    background: var(--bg-primary);
    border: 2px solid var(--border-color);
    border-radius: 16px;
    max-width: 600px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    animation: slideUp 0.3s ease;
}

.info-modal-header-home {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.5rem;
    border-bottom: 2px solid var(--border-color);
}

.info-modal-header-home h3 {
    margin: 0;
    font-size: 1.5rem;
    color: var(--text-primary);
}

.info-modal-close-home {
    background: transparent;
    border: none;
    cursor: pointer;
    color: var(--text-secondary);
    padding: 0.5rem;
    border-radius: 8px;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
}

.info-modal-close-home:hover {
    background: var(--bg-secondary);
    color: var(--text-primary);
}

.info-modal-body-home {
    padding: 1.5rem;
    color: var(--text-primary);
    line-height: 1.6;
}

.info-modal-body-home p {
    margin: 0 0 1rem 0;
}

.info-modal-body-home ul {
    margin: 1rem 0;
    padding-left: 1.5rem;
}

.info-modal-body-home li {
    margin-bottom: 0.5rem;
}

@keyframes slideUp {
    from {
        transform: translateY(30px);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}
    border-left: 4px solid var(--color-primary);
}

.scoring-explanation p {
    margin: 0;
    color: var(--text-primary);
    line-height: 1.6;
}

/* Tabs */
.tabs-container {
    margin-bottom: 2rem;
}

.tabs-nav {
    display: flex;
    gap: 0.5rem;
    border-bottom: 2px solid var(--border-color);
    margin-bottom: 2rem;
    flex-wrap: wrap;
}

.tab-btn {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1.5rem;
    background: transparent;
    border: none;
    border-bottom: 3px solid transparent;
    color: var(--text-secondary);
    font-weight: 600;
    font-size: 0.95rem;
    cursor: pointer;
    transition: all 0.2s ease;
    font-family: 'Lexend', sans-serif;
    margin-bottom: -2px;
}

.tab-btn:hover {
    color: var(--color-primary);
    background: color-mix(in srgb, var(--color-primary) 5%, transparent);
}

.tab-btn.active {
    color: var(--color-primary);
    border-bottom-color: var(--color-primary);
    background: color-mix(in srgb, var(--color-primary) 8%, transparent);
}

.tab-btn svg {
    width: 18px;
    height: 18px;
}

.tab-content {
    display: none;
}

.tab-content.active {
    display: block;
}

@media (max-width: 768px) {
    .header-content {
        flex-direction: column;
    }

    .stats-grid {
        grid-template-columns: 1fr;
    }

    .ranking-grid {
        grid-template-columns: repeat(2, 1fr);
    }

    .publications-table-container {
        overflow-x: auto;
    }

    .faculty-cards-grid {
        grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
        gap: 1rem;
    }

    .faculty-tab-buttons {
        overflow-x: auto;
        flex-wrap: nowrap;
        -webkit-overflow-scrolling: touch;
    }

    .faculty-tab-btn {
        white-space: nowrap;
        flex-shrink: 0;
        padding: 0.75rem 1.25rem;
        font-size: 0.875rem;
    }

    .faculty-card-name {
        font-size: 1rem;
    }

    .faculty-card-score,
    .faculty-card-citation,
    .faculty-card-pubs {
        font-size: 0.8rem;
    }

    .golden-rank-badge {
        font-size: 0.7rem;
        padding: 0.3rem 0.6rem;
    }

    .faculty-badge {
        width: 1.75rem;
        height: 1.75rem;
        font-size: 0.9rem;
    }

    .tabs-nav {
        flex-direction: column;
        gap: 0;
    }

    .tab-btn {
        width: 100%;
        justify-content: flex-start;
        border-bottom: 1px solid var(--border-color);
        border-left: 3px solid transparent;
        margin-bottom: 0;
    }

    .tab-btn.active {
        border-left-color: var(--color-primary);
        border-bottom-color: var(--border-color);
    }

    .top-researchers-list {
        gap: 1rem;
    }

    .researcher-section {
        margin-bottom: 2rem;
    }

    .researcher-section-title {
        font-size: 1.25rem;
    }

    .researcher-card {
        width: 100%;
        max-width: 300px;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const tabButtons = document.querySelectorAll('.tab-btn');
    const tabContents = document.querySelectorAll('.tab-content');
    
    // Function to update URL with tab parameter
    function updateTabInURL(tab) {
        const url = new URL(window.location);
        url.searchParams.set('tab', tab);
        // Preserve period parameter if it exists
        const period = url.searchParams.get('period') || 'all_time';
        window.history.pushState({}, '', `?period=${period}&tab=${tab}`);
    }
    
    // Function to update filter button hrefs with current tab
    function updateFilterButtonHrefs(currentTab) {
        const filterButtons = document.querySelectorAll('.filter-btn');
        filterButtons.forEach(button => {
            const period = button.dataset.period;
            if (period) {
                button.href = `?period=${period}&tab=${currentTab}`;
            }
        });
    }
    
    // Function to switch tabs
    function switchTab(targetTab) {
        // Remove active class from all buttons and contents
        tabButtons.forEach(btn => btn.classList.remove('active'));
        tabContents.forEach(content => content.classList.remove('active'));
        
        // Add active class to clicked button and corresponding content
        const activeButton = document.querySelector(`[data-tab="${targetTab}"]`);
        const activeContent = document.getElementById(targetTab + '-tab');
        
        if (activeButton) activeButton.classList.add('active');
        if (activeContent) activeContent.classList.add('active');
        
        // Update URL and localStorage
        updateTabInURL(targetTab);
        localStorage.setItem('research_page_tab', targetTab);
        
        // Update filter button hrefs to preserve current tab
        updateFilterButtonHrefs(targetTab);
    }
    
    // Initialize tab from URL or localStorage
    const urlParams = new URLSearchParams(window.location.search);
    const urlTab = urlParams.get('tab');
    const storedTab = localStorage.getItem('research_page_tab');
    const initialTab = urlTab || storedTab || 'stats';
    
    // Initialize filter button hrefs with current tab
    updateFilterButtonHrefs(initialTab);
    
    if (initialTab !== 'stats') {
        switchTab(initialTab);
    }
    
    // Handle tab button clicks
    tabButtons.forEach(button => {
        button.addEventListener('click', function() {
            const targetTab = this.dataset.tab;
            switchTab(targetTab);
        });
    });
    
    // Faculty view tabs (All Faculties, Most Cited, Leading Active)
    const facultyTabButtons = document.querySelectorAll('.faculty-tab-btn');
    const facultyTabContents = document.querySelectorAll('.faculty-tab-content');
    
    facultyTabButtons.forEach(button => {
        button.addEventListener('click', function(e) {
            // Don't switch tabs if clicking the info button
            if (e.target.closest('.faculty-tab-info-btn')) {
                return;
            }
            const targetTab = this.getAttribute('data-faculty-tab');
            
            // Remove active class from all buttons and contents
            facultyTabButtons.forEach(btn => btn.classList.remove('active'));
            facultyTabContents.forEach(content => content.classList.remove('active'));
            
            // Add active class to clicked button and corresponding content
            this.classList.add('active');
            const targetContent = document.getElementById(targetTab + '-tab');
            if (targetContent) {
                targetContent.classList.add('active');
            }
        });
    });
    
    // Info modal functionality
    const infoBtn = document.getElementById('scoring-info-btn');
    const infoModal = document.getElementById('scoring-info-modal');
    const closeModal = document.getElementById('close-info-modal');
    
    if (infoBtn && infoModal) {
        infoBtn.addEventListener('click', function() {
            infoModal.classList.add('active');
        });
    }
    
    if (closeModal && infoModal) {
        closeModal.addEventListener('click', function() {
            infoModal.classList.remove('active');
        });
    }
    
    // Close modal when clicking outside
    if (infoModal) {
        infoModal.addEventListener('click', function(e) {
            if (e.target === infoModal) {
                infoModal.classList.remove('active');
            }
        });
    }
    
    // Faculty Tab Info Modal Functions
    function openFacultyTabInfoModal(tabName) {
        const modal = document.getElementById('faculty-' + tabName + '-info-modal');
        if (modal) {
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }
    }
    
    function closeFacultyTabInfoModal(tabName) {
        const modal = document.getElementById('faculty-' + tabName + '-info-modal');
        if (modal) {
            modal.classList.remove('active');
            document.body.style.overflow = '';
        }
    }
    
    // Make functions global
    window.openFacultyTabInfoModal = openFacultyTabInfoModal;
    window.closeFacultyTabInfoModal = closeFacultyTabInfoModal;
    
    // Close faculty tab info modals on background click
    document.addEventListener('click', function(e) {
        const modals = ['faculty-all-faculties-info-modal', 'faculty-most-cited-info-modal', 'faculty-leading-active-info-modal', 'faculty-top-designation-info-modal'];
        modals.forEach(modalId => {
            const modal = document.getElementById(modalId);
            if (modal && e.target === modal) {
                modal.classList.remove('active');
                document.body.style.overflow = '';
            }
        });
    });
    
    // Close faculty tab info modals on Escape key
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            const modals = ['faculty-all-faculties-info-modal', 'faculty-most-cited-info-modal', 'faculty-leading-active-info-modal', 'faculty-top-designation-info-modal'];
            modals.forEach(modalId => {
                const modal = document.getElementById(modalId);
                if (modal && modal.classList.contains('active')) {
                    modal.classList.remove('active');
                    document.body.style.overflow = '';
                }
            });
        }
    });
});
</script>

<!-- Info Modal -->
<div class="info-modal" id="scoring-info-modal">
    <div class="info-modal-content">
        <div class="info-modal-header">
            <h3 class="info-modal-title">Research Score Calculation</h3>
            <button class="info-modal-close" id="close-info-modal">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>
        <div class="info-modal-body">
            <p>The research score is calculated based on the ranking of each publication:</p>
            <table class="scoring-table">
                <thead>
                    <tr>
                        <th>Ranking</th>
                        <th>Points</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Q1</td>
                        <td>{{ scoring_system.q1 }} points</td>
                    </tr>
                    <tr>
                        <td>Q2</td>
                        <td>{{ scoring_system.q2 }} points</td>
                    </tr>
                    <tr>
                        <td>Q3</td>
                        <td>{{ scoring_system.q3 }} points</td>
                    </tr>
                    <tr>
                        <td>Q4</td>
                        <td>{{ scoring_system.q4 }} points</td>
                    </tr>
                    <tr>
                        <td>A*</td>
                        <td>{{ scoring_system.a_star }} points</td>
                    </tr>
                    <tr>
                        <td>A</td>
                        <td>{{ scoring_system.a }} points</td>
                    </tr>
                    <tr>
                        <td>B</td>
                        <td>{{ scoring_system.b }} points</td>
                    </tr>
                    <tr>
                        <td>C</td>
                        <td>{{ scoring_system.c }} points</td>
                    </tr>
                    <tr>
                        <td>Not Indexed</td>
                        <td>{{ scoring_system.not_indexed }} point</td>
                    </tr>
                </tbody>
            </table>
            <div class="scoring-explanation">
                <p><strong>How it works:</strong> Each faculty member's total research score is the sum of points from all their publications within the selected time period. Higher-ranked publications contribute more points to the overall score.</p>
            </div>
        </div>
    </div>
</div>

<!-- Faculty Tab Info Modals -->
<div class="info-modal-home" id="faculty-all-faculties-info-modal">
    <div class="info-modal-content-home">
        <div class="info-modal-header-home">
            <h3>All Faculties</h3>
            <button class="info-modal-close-home" onclick="closeFacultyTabInfoModal('all-faculties')">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>
        <div class="info-modal-body-home">
            <p>This view displays all current faculty members with their research scores and citation counts. Faculty members who rank in the top 4 of any category (Most Cited, Leading Active, or Top by Designation) are marked with badges.</p>
        </div>
    </div>
</div>

<div class="info-modal-home" id="faculty-most-cited-info-modal">
    <div class="info-modal-content-home">
        <div class="info-modal-header-home">
            <h3>Most Cited Researchers (All Time)</h3>
            <button class="info-modal-close-home" onclick="closeFacultyTabInfoModal('most-cited')">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>
        <div class="info-modal-body-home">
            <p>This section displays all faculty members sorted by their total citation count across all their publications, from all time. The top 4 researchers are highlighted with a golden badge.</p>
        </div>
    </div>
</div>

<div class="info-modal-home" id="faculty-leading-active-info-modal">
    <div class="info-modal-content-home">
        <div class="info-modal-header-home">
            <h3>Leading Active Researchers (Past 2yr)</h3>
            <button class="info-modal-close-home" onclick="closeFacultyTabInfoModal('leading-active')">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>
        <div class="info-modal-body-home">
            <p>This section identifies the most active researchers based on their research score from publications released in the last two years. The score is calculated as follows:</p>
            <ul>
                <li><strong>Q1 publications:</strong> 10 points each</li>
                <li><strong>Q2 publications:</strong> 7 points each</li>
                <li><strong>Q3 publications:</strong> 5 points each</li>
                <li><strong>Q4 publications:</strong> 3 points each</li>
                <li><strong>A* publications:</strong> 8 points each</li>
                <li><strong>A publications:</strong> 6 points each</li>
                <li><strong>B publications:</strong> 4 points each</li>
                <li><strong>C publications:</strong> 2 points each</li>
                <li><strong>Not Indexed:</strong> 1 point each</li>
            </ul>
            <p>The top 4 researchers are highlighted with a golden badge.</p>
        </div>
    </div>
</div>

<div class="info-modal-home" id="faculty-top-designation-info-modal">
    <div class="info-modal-content-home">
        <div class="info-modal-header-home">
            <h3>Top Researchers (Designation Wise)</h3>
            <button class="info-modal-close-home" onclick="closeFacultyTabInfoModal('top-designation')">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>
        <div class="info-modal-body-home">
            <p>This section showcases researchers grouped by their academic designation (Professor, Associate Professor, Assistant Professor, Lecturer). The top researcher from each designation is highlighted with a golden badge.</p>
            <p>The selection is based on their overall research score, calculated from all their publications:</p>
            <ul>
                <li><strong>Q1 publications:</strong> 10 points each</li>
                <li><strong>Q2 publications:</strong> 7 points each</li>
                <li><strong>Q3 publications:</strong> 5 points each</li>
                <li><strong>Q4 publications:</strong> 3 points each</li>
                <li><strong>A* publications:</strong> 8 points each</li>
                <li><strong>A publications:</strong> 6 points each</li>
                <li><strong>B publications:</strong> 4 points each</li>
                <li><strong>C publications:</strong> 2 points each</li>
                <li><strong>Not Indexed:</strong> 1 point each</li>
            </ul>
            <p>In case of a tie in score, the researcher with publications spanning fewer years (more concentrated research) is selected.</p>
        </div>
    </div>
</div>

{% endblock %}

